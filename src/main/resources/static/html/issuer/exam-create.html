<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>试卷创建</title>
		<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css">
		<link href="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
		      rel="stylesheet">

		<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
		<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<!--DateTimepicker-->
		<script src="https://cdn.bootcss.com/moment.js/2.18.1/moment-with-locales.min.js"></script>
		<script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
		<!--BootStrap Table-->
		<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>

	</head>
	<style>
        #question-table tr:nth-child(even) {
            background: #f4f8fb;
        }

        .black_overlay {

            display: none;
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            background-color: #c8c8c8;
            z-index: 1001;
            -moz-opacity: 0.8;
            opacity: .80;
            filter: alpha(opacity=78);
        }

        .pop_win {

            display: none;
            position: absolute;
            top: 10%;
            left: 23%;
            width: 55%;
            height: 75%;
            padding: 10px;
            /*border-radius: 36px 38px 49px 40px / 53px 47px 51px 54px;*/
            border: 2px solid cornflowerblue;
            background-color: white;
            z-index: 9999;
            overflow: auto;
        }
	</style>

	<body>
		<nav th:replace="../static/html/common/fragments.html::issuer_menu(3)"></nav>

		<div class="container">
			<form class="form" method="post" role="form">
				<h1 id="add-title">创建一场考试</h1>
				<br>
				<div class="form-group">
					<label for="exam-name">考试名称</label>
					<input type="text" id="exam-name" class="form-control" placeholder="这里什么都没有" required autofocus>
				</div>
				<div class="form-group">
					<label for="exam-start-time">开始时间</label>
					<div class='input-group date form-date form_datetime' id='exam-start-time'>
						<input type='text' class="form-control" id="start_time"/>
						<span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
					</div>
				</div>
				<div class="form-group">
					<label for="exam-end-time">结束时间</label>
					<!--指定 date标记-->
					<div class='input-group date' id='exam-end-time'>
						<input type='text' class="form-control" id="end_time"/>
						<span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
					</div>
				</div>
				<input name="_csrf" type="hidden" value="93edbebc-aa90-4b8c-b372-28f922a9a9e6"/>
				<button class="btn btn-lg btn-primary btn-block" type="button" id="exam-update-btn" onclick="update()">
					保存问题
				</button>
			</form>
		</div>


	</body>
	<script>
        //更新函数
        function update() {
            var st = $("#start_time").val();
            var et = $("#end_time").val();
            let formData = JSON.stringify({
                "name": $("#exam-name").val(),
                "questions": [],
                "startTime": $("#start_time").val(),
                "endTime": $("#end_time").val()
            });
            $.ajax({
                url: "/issuer/createExam",
                type: "post",
                contentType: "application/json",
                data: formData,
                dataType: "json"
            }).done(function (result) {
                if (result.code == 200) {
                    alert("保存试卷成功,赶紧去为考试添加问题吧!");
                    location.reload();
                    location.href = "/issuer/updateExam/" + result.data.id;
                } else alert("添加试卷失败!！");
            })
        }


        $('#exam-start-time').datetimepicker({
            format: 'YYYY-MM-DD hh:mm:ss',
            locale: moment.locale('zh-cn')
        });
        $('#exam-end-time').datetimepicker({
            format: 'YYYY-MM-DD hh:mm:ss',
            locale: moment.locale('zh-cn')
        });


        //编辑窗口提交操作
        $("#question-add-btn").click(function () {
            // alert("点了我！")
            let questionToAdd = JSON.stringify({
                "infoTextContent": $("#question-add-info").val(),
                "score": $("#question-add-score").val(),
                "type": $("#question-add-type").val(),
                "correctAnswer": $("#question-add-answer").val(),
                "deleted": $("#canUse").val() == "是" ? false : true
            });
            let s = JSON.stringify(exam.questions);
            s = s.substr(0, s.length - 1) + ',' + questionToAdd + ']';
            exam.questions = JSON.parse(s);
            update();
            closeWin();
        })

        /*窗口弹出添加修改函数*/
        function popWinToAdd() {
            document.getElementById('lightToAdd').style.display = 'block';
            document.getElementById('fade').style.display = 'block';
        }

        /*窗口弹出编辑函数*/
        function popWinToEdit(question) {
            /*数据回显*/
            document.getElementById("edit-title").innerText = "编辑问题" + question.data.id;
            $("#question-edit-id").val(question.data.id);
            $("#question-edit-btn").val(question.data.type);
            $("#question-info").val(question.data.infoTextContent);
            $("#answer").val(question.data.correctAnswer);
            $("#score").val(question.data.score);
            $("#delete").val((question.data.deleted) ? "是" : "否");
            document.getElementById('lightToEdit').style.display = 'block';
            document.getElementById('fade').style.display = 'block'
        }

        function flash() {
            console.log("faf");
            $('#bootstrap-table').bootstrapTable('destroy');
            $('#question-table').bootstrapTable('refresh');
        }

        /*窗口关闭函数*/
        function closeWin() {
            document.getElementById('lightToEdit').style.display = 'none';
            document.getElementById('lightToAdd').style.display = 'none';
            document.getElementById('fade').style.display = 'none';

            $('#question-table').bootstrapTable('refresh');
            // location.reload();
        }


	</script>
</html>
